@page "/plant/{Id:guid}"
@using SpringRidgeFlowers.Services.Interfaces
@inject IPlantService PlantService
@inject NavigationManager Navigation

<PageTitle>@(_plant?.CommonName ?? "Plant Details") - Spring Ridge Flowers</PageTitle>

@if (_loading)
{
    <MudProgressCircular Color="Color.Primary" Indeterminate="true" />
}
else if (_plant == null)
{
    <MudAlert Severity="Severity.Warning">Plant not found.</MudAlert>
    <MudButton Variant="Variant.Text" Color="Color.Primary" Href="/catalog" Class="mt-2">
        Back to Catalog
    </MudButton>
}
else
{
    <MudBreadcrumbs Items="_breadcrumbs" Class="mb-4" />

    <MudGrid>
        <MudItem xs="12" md="6">
            <PlantImageGallery ImageUrls="_plant.ImageUrls" AltText="@_plant.CommonName" />
        </MudItem>

        <MudItem xs="12" md="6">
            <MudText Typo="Typo.h4">@_plant.CommonName</MudText>
            @if (!string.IsNullOrEmpty(_plant.LatinName))
            {
                <MudText Typo="Typo.subtitle1" Color="Color.Secondary" Class="font-italic">
                    @_plant.LatinName
                </MudText>
            }

            <PriceDisplay Price="_plant.Price" Class="my-3" />

            @if (_plant.InStock)
            {
                <MudChip T="string" Color="Color.Success" Size="Size.Small">In Stock</MudChip>
            }
            else
            {
                <MudChip T="string" Color="Color.Error" Size="Size.Small">Out of Stock</MudChip>
            }

            <MudStack Row="true" Class="my-3" Wrap="Wrap.Wrap">
                @if (_plant.IsFloridaNative)
                {
                    <MudChip T="string" Color="Color.Primary" Size="Size.Small"
                             Icon="@Icons.Material.Filled.Grass">Florida Native</MudChip>
                }
                @if (_plant.Edible)
                {
                    <MudChip T="string" Color="Color.Tertiary" Size="Size.Small"
                             Icon="@Icons.Material.Filled.Restaurant">Edible</MudChip>
                }
                @if (!string.IsNullOrEmpty(_plant.LifeCycle))
                {
                    <MudChip T="string" Variant="Variant.Outlined" Size="Size.Small">@_plant.LifeCycle</MudChip>
                }
                @if (!string.IsNullOrEmpty(_plant.SunExposure))
                {
                    <MudChip T="string" Variant="Variant.Outlined" Size="Size.Small"
                             Icon="@Icons.Material.Filled.WbSunny">@_plant.SunExposure</MudChip>
                }
            </MudStack>

            <MudDivider Class="my-3" />

            @if (!string.IsNullOrEmpty(_plant.Description))
            {
                <MudText Typo="Typo.body1" Class="mb-4">@_plant.Description</MudText>
            }

            <MudSimpleTable Dense="true" Hover="true" Class="mb-4">
                <tbody>
                    @if (!string.IsNullOrEmpty(_plant.Size))
                    {
                        <tr><td><strong>Size</strong></td><td>@_plant.Size</td></tr>
                    }
                    @if (!string.IsNullOrEmpty(_plant.WaterNeeds))
                    {
                        <tr><td><strong>Water Needs</strong></td><td>@_plant.WaterNeeds</td></tr>
                    }
                    @if (!string.IsNullOrEmpty(_plant.SoilMoisture))
                    {
                        <tr><td><strong>Soil Moisture</strong></td><td>@_plant.SoilMoisture</td></tr>
                    }
                    @if (!string.IsNullOrEmpty(_plant.ColdTolerance))
                    {
                        <tr><td><strong>Cold Tolerance</strong></td><td>@_plant.ColdTolerance</td></tr>
                    }
                    @if (_plant.SeedPacketSizes.Any())
                    {
                        <tr><td><strong>Seed Packets</strong></td><td>@string.Join(", ", _plant.SeedPacketSizes.Select(s => $"{s}g"))</td></tr>
                    }
                    @if (_plant.PlantPotSizes.Any())
                    {
                        <tr><td><strong>Pot Sizes</strong></td><td>@string.Join(", ", _plant.PlantPotSizes.Select(s => $"{s}\""))</td></tr>
                    }
                </tbody>
            </MudSimpleTable>

            <MudButton Variant="Variant.Text" Color="Color.Primary" Href="/catalog"
                       StartIcon="@Icons.Material.Filled.ArrowBack">
                Back to Catalog
            </MudButton>
        </MudItem>
    </MudGrid>
}

@code {
    [Parameter] public Guid Id { get; set; }

    private PlantDto? _plant;
    private bool _loading = true;
    private List<BreadcrumbItem> _breadcrumbs = new();

    protected override async Task OnInitializedAsync()
    {
        _plant = await PlantService.GetPlantByIdAsync(Id);
        _loading = false;

        _breadcrumbs = new List<BreadcrumbItem>
        {
            new("Home", href: "/"),
            new("Catalog", href: "/catalog"),
            new(_plant?.CommonName ?? "Details", href: null, disabled: true)
        };
    }
}
